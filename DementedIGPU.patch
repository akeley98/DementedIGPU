*** /etc/grub.d/10_linux	2018-08-01 23:22:19.747855628 -0700
--- /etc/grub.d/10_linux	2018-08-01 02:22:34.216768725 -0700
***************
*** 103,112 ****
--- 103,135 ----
      fi
    done
  fi
  
+ # My hack: wrap the original linux_entry function (that generates a
+ # menu entry for booting this distro; now named demented_linux_entry)
+ # with this new function, which for every 1 menu generated by the
+ # original function now generates 2 menu options, one for nvidia and
+ # one for iGPU graphics.  Since the iGPU option works by targetting a
+ # custom iGPU systemd target, this doesn't mesh well with recovery
+ # options; exclude iGPU options for them.
  linux_entry ()
  {
+   local os_="$1"
+   local version_="$2"
+   local type_="$3"
+   local args_="$4"
+   local igpu_args="${args_} systemd.unit=DementedIGPU.target acpi_rev_override=1"
+   # Move the (X) line here if you prefer Nvidia entries first.
+   if [ "${type_}" != "recovery" ]; then
+     demented_linux_entry "${os_} (iGPU)" "${version_}" "${type_}" "${igpu_args}"
+   fi
+   demented_linux_entry "${os_}" "${version_}" "${type_}" "${args_}" # (X)
+ }
+
+ # Do NOT rename this function! We check for it to avoid patching twice.
+ demented_linux_entry ()
+ {
+   echo "DementedIGPU: Now adding linux entry '$1' '$2' '$3' '$4'." >&2
    os="$1"
    version="$2"
    type="$3"
    args="$4"
