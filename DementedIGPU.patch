*** /etc/grub.d/10_linux	2018-08-01 01:38:55.983870600 -0700
--- /etc/grub.d/10_linux	2018-08-02 11:03:26.414522229 -0700
***************
*** 2,9 ****
--- 2,11 ----
  set -e
  
  # grub-mkconfig helper script.
  # Copyright (C) 2006,2007,2008,2009,2010  Free Software Foundation, Inc.
+ # Modified by DementedIGPU script (Add Nvidia & iGPU GRUB boot menu options).
+ # https://github.com/akeley98/DementedIGPU
  #
  # GRUB is free software: you can redistribute it and/or modify
  # it under the terms of the GNU General Public License as published by
  # the Free Software Foundation, either version 3 of the License, or
***************
*** 103,112 ****
--- 105,137 ----
      fi
    done
  fi
  
+ # My hack: wrap the original linux_entry function (that generates a
+ # menu entry for booting this distro; now named demented_linux_entry)
+ # with this new function, which for every 1 menu generated by the
+ # original function now generates 2 menu options, one for nvidia and
+ # one for iGPU graphics.  Since the iGPU option works by targetting a
+ # custom iGPU systemd target, this doesn't mesh well with recovery
+ # options; exclude iGPU options for them.
  linux_entry ()
  {
+   local os_="$1"
+   local version_="$2"
+   local type_="$3"
+   local args_="$4"
+   local igpu_args="${args_} systemd.unit=DementedIGPU.target acpi_rev_override=1"
+   # Move the (X) line here if you prefer Nvidia entries first.
+   if [ "${type_}" != "recovery" ]; then
+     demented_linux_entry "${os_} (iGPU)" "${version_}" "${type_}" "${igpu_args}"
+   fi
+   demented_linux_entry "${os_}" "${version_}" "${type_}" "${args_}" # (X)
+ }
+ 
+ # Do NOT rename this function! We check for it to avoid patching twice.
+ demented_linux_entry ()
+ {
+   echo "DementedIGPU: Now adding linux entry '$1' '$2' '$3' '$4'." >&2
    os="$1"
    version="$2"
    type="$3"
    args="$4"
